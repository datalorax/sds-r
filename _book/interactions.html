<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.8 Interactions | Social Data Science with R</title>
  <meta name="description" content="This is basically course notes corresponding to a series of courses in educational data science, which are generally applicable to a wide range of social data science problems, taught through R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.8 Interactions | Social Data Science with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is basically course notes corresponding to a series of courses in educational data science, which are generally applicable to a wide range of social data science problems, taught through R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.8 Interactions | Social Data Science with R" />
  
  <meta name="twitter:description" content="This is basically course notes corresponding to a series of courses in educational data science, which are generally applicable to a wide range of social data science problems, taught through R." />
  

<meta name="author" content="Daniel Anderson" />
<meta name="author" content="Brendan Cullen" />
<meta name="author" content="Ouafaa Hmaddi" />


<meta name="date" content="2020-11-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="nonlinearity.html"/>
<link rel="next" href="pca.html"/>
<script src="assets/header-attrs-2.5/header-attrs.js"></script>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="assets/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.0/anchor-sections.js"></script>
<script src="assets/core-js-2.5.3/shim.min.js"></script>
<script src="assets/react-16.12.0/react.min.js"></script>
<script src="assets/react-16.12.0/react-dom.min.js"></script>
<script src="assets/reactwidget-1.0.0/react-tools.js"></script>
<script src="assets/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="assets/reactable-binding-0.2.3/reactable.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/3.5.16/iframeResizer.min.js" type="text/javascript"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="welcome.html"><a href="welcome.html"><i class="fa fa-check"></i><b>2</b> Welcome</a></li>
<li class="chapter" data-level="3" data-path="feature-engineering.html"><a href="feature-engineering.html"><i class="fa fa-check"></i><b>3</b> Feature Engineering</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basics-of-recipes.html"><a href="basics-of-recipes.html"><i class="fa fa-check"></i><b>3.1</b> Basics of {recipes}</a></li>
<li class="chapter" data-level="3.2" data-path="creating-a-recipe.html"><a href="creating-a-recipe.html"><i class="fa fa-check"></i><b>3.2</b> Creating a recipe</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="creating-a-recipe.html"><a href="creating-a-recipe.html#order-matters"><i class="fa fa-check"></i><b>3.2.1</b> Order matters</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="encoding-categorical-data.html"><a href="encoding-categorical-data.html"><i class="fa fa-check"></i><b>3.3</b> Encoding categorical data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="encoding-categorical-data.html"><a href="encoding-categorical-data.html#transformations-beyond-dummy-coding"><i class="fa fa-check"></i><b>3.3.1</b> Transformations beyond dummy coding</a></li>
<li class="chapter" data-level="3.3.2" data-path="encoding-categorical-data.html"><a href="encoding-categorical-data.html#handling-new-levels"><i class="fa fa-check"></i><b>3.3.2</b> Handling new levels</a></li>
<li class="chapter" data-level="3.3.3" data-path="encoding-categorical-data.html"><a href="encoding-categorical-data.html#final-thoughts-on-encoding-categorical-data"><i class="fa fa-check"></i><b>3.3.3</b> Final thoughts on encoding categorical data</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="dealing-with-low-variance-predictors.html"><a href="dealing-with-low-variance-predictors.html"><i class="fa fa-check"></i><b>3.4</b> Dealing with low variance predictors</a></li>
<li class="chapter" data-level="3.5" data-path="missing-data.html"><a href="missing-data.html"><i class="fa fa-check"></i><b>3.5</b> Missing data</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="missing-data.html"><a href="missing-data.html#missing-data-via-recipes"><i class="fa fa-check"></i><b>3.5.1</b> Missing data via {recipes}</a></li>
<li class="chapter" data-level="3.5.2" data-path="missing-data.html"><a href="missing-data.html#a-few-words-of-caution"><i class="fa fa-check"></i><b>3.5.2</b> A few words of caution</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>3.6</b> Transformations</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="transformations.html"><a href="transformations.html#box-cox-and-similar-transformations"><i class="fa fa-check"></i><b>3.6.1</b> Box-Cox and similar transformations</a></li>
<li class="chapter" data-level="3.6.2" data-path="transformations.html"><a href="transformations.html#an-applied-example"><i class="fa fa-check"></i><b>3.6.2</b> An applied example</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="nonlinearity.html"><a href="nonlinearity.html"><i class="fa fa-check"></i><b>3.7</b> Nonlinearity</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="nonlinearity.html"><a href="nonlinearity.html#polynomial-transformations"><i class="fa fa-check"></i><b>3.7.1</b> Polynomial transformations</a></li>
<li class="chapter" data-level="3.7.2" data-path="nonlinearity.html"><a href="nonlinearity.html#splines"><i class="fa fa-check"></i><b>3.7.2</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>3.8</b> Interactions</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="interactions.html"><a href="interactions.html#creating-interactions-by-hand"><i class="fa fa-check"></i><b>3.8.1</b> Creating interactions “by hand”</a></li>
<li class="chapter" data-level="3.8.2" data-path="interactions.html"><a href="interactions.html#creating-interactions-with-recipes"><i class="fa fa-check"></i><b>3.8.2</b> Creating interactions with {recipes}</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>3.9</b> PCA</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="pca.html"><a href="pca.html#pca-with-recipes"><i class="fa fa-check"></i><b>3.9.1</b> PCA with {recipes}</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="wrapping-up.html"><a href="wrapping-up.html"><i class="fa fa-check"></i><b>3.10</b> Wrapping up</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Social Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactions" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Interactions</h2>
<p>An interaction occurs when the slope, or relation, between one variable and the outcome <em>depends upon</em> a second variable. This is also often referred to as <em>moderation</em> or a <em>moderating variable</em>. For example, consider data that look like this</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="interactions.html#cb139-1"></a>benchmarks &lt;-<span class="st"> </span><span class="kw">read_csv</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;benchmarks.csv&quot;</span>))</span>
<span id="cb139-2"><a href="interactions.html#cb139-2"></a></span>
<span id="cb139-3"><a href="interactions.html#cb139-3"></a><span class="kw">ggplot</span>(benchmarks, <span class="kw">aes</span>(rdg_fall, rdg_spr)) <span class="op">+</span></span>
<span id="cb139-4"><a href="interactions.html#cb139-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb139-5"><a href="interactions.html#cb139-5"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> ell),</span>
<span id="cb139-6"><a href="interactions.html#cb139-6"></a>              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
<p>where <em>ell</em> stands for <em>English language learner</em>. The plot above shows the relation between students scores on a reading assessment administered in the fall and the spring by ELL status. Notice that the slope for <em>Non-ELL</em> is markedly steeper than the other two groups. ELL status thus moderates the relation between the fall and spring assessment scores. If we’re fitting a model within a linear regression framework, we’ll want to make sure that we model the slopes separately for each of these groups (otherwise we would be leaving out important structure in the data, and our model performance would suffer). Interactions are powerful and important to consider, particularly if there is strong theory (or empirical evidence) suggesting that an interaction exists. However, they are not needed in many frameworks and can be derived from the data directly (e.g., tree-based methods, where the degree of possible interaction is determined by the depth of the tree). In this section, we therefore focus on interactions within a linear regression framework.</p>
<div id="creating-interactions-by-hand" class="section level3" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Creating interactions “by hand”</h3>
<p>Even with base R, modeling interactions is pretty straightforward. In the above, we would just specify something like</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="interactions.html#cb140-1"></a><span class="kw">lm</span>(rdg_spr <span class="op">~</span><span class="st"> </span>rdg_fall<span class="op">*</span>ell, <span class="dt">data =</span> benchmarks)</span></code></pre></div>
<p>or equivalently</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="interactions.html#cb141-1"></a><span class="kw">lm</span>(rdg_spr <span class="op">~</span><span class="st"> </span>rdg_fall <span class="op">+</span><span class="st"> </span>ell <span class="op">+</span><span class="st"> </span>rdg_fall<span class="op">:</span>ell, <span class="dt">data =</span> benchmarks)</span></code></pre></div>
<p>However, this is doing some work under the hood for you which might go unnoticed. First, it’s dummy-coding <code>ell</code>, then it’s creating, in this case, two new variables that are equal to <span class="math inline">\(ELL_{Monitor} \times Rdg_{fall}\)</span> and <span class="math inline">\(ELL_{Non-ELL} \times Rdg_{fall}\)</span> (with <span class="math inline">\(ELL_{Active}\)</span> set as the reference group by default).</p>
<p>Let’s try doing this manually. First we need to dummy code <code>ell</code>. To make things a bit more clear, I’ll only select the variables here that we’re using in our modeling.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="interactions.html#cb142-1"></a>dummies &lt;-<span class="st"> </span>benchmarks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-2"><a href="interactions.html#cb142-2"></a><span class="st">  </span><span class="kw">select</span>(rdg_fall, ell, rdg_spr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-3"><a href="interactions.html#cb142-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ell_monitor =</span> <span class="kw">ifelse</span>(ell <span class="op">==</span><span class="st"> &quot;Monitor&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb142-4"><a href="interactions.html#cb142-4"></a>         <span class="dt">ell_non =</span> <span class="kw">ifelse</span>(ell <span class="op">==</span><span class="st"> &quot;Non-ELL&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),)</span>
<span id="cb142-5"><a href="interactions.html#cb142-5"></a>dummies</span></code></pre></div>
<pre><code>## # A tibble: 174 x 5
##    rdg_fall ell     rdg_spr ell_monitor ell_non
##       &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;
##  1      181 Active      194           0       0
##  2      166 Non-ELL     159           0       1
##  3      216 Non-ELL     198           0       1
##  4      203 Non-ELL     204           0       1
##  5      198 Active      173           0       0
##  6      188 Active      173           0       0
##  7      202 Monitor     200           1       0
##  8      182 Active      206           0       0
##  9      194 Non-ELL     191           0       1
## 10      170 Active      185           0       0
## # … with 164 more rows</code></pre>
<p>Next, we’ll multiply each of these dummy variables by <code>rdg_fall</code>.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="interactions.html#cb144-1"></a>interactions &lt;-<span class="st"> </span>dummies <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb144-2"><a href="interactions.html#cb144-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fall_monitor =</span> rdg_fall <span class="op">*</span><span class="st"> </span>ell_monitor,</span>
<span id="cb144-3"><a href="interactions.html#cb144-3"></a>         <span class="dt">fall_non =</span> rdg_fall <span class="op">*</span><span class="st"> </span>ell_non)</span>
<span id="cb144-4"><a href="interactions.html#cb144-4"></a>interactions</span></code></pre></div>
<pre><code>## # A tibble: 174 x 7
##    rdg_fall ell     rdg_spr ell_monitor ell_non fall_monitor fall_non
##       &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
##  1      181 Active      194           0       0            0        0
##  2      166 Non-ELL     159           0       1            0      166
##  3      216 Non-ELL     198           0       1            0      216
##  4      203 Non-ELL     204           0       1            0      203
##  5      198 Active      173           0       0            0        0
##  6      188 Active      173           0       0            0        0
##  7      202 Monitor     200           1       0          202        0
##  8      182 Active      206           0       0            0        0
##  9      194 Non-ELL     191           0       1            0      194
## 10      170 Active      185           0       0            0        0
## # … with 164 more rows</code></pre>
<p>As would be expected, these values are zero if they are not for the corresponding group, and are otherwise equal to <code>rdg_fall</code>. If we enter all these variables in our model, then our model intercept will represent the intercept for the active group, with the corresponding slope estimated by <code>rdg_fall</code>. The <code>ell_monitor</code> and <code>ell_non</code> terms represent the intercepts for the monitor and non-ELL groups, respectively, and each of these slopes are estimated by the corresponding interaction. Let’s try.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="interactions.html#cb146-1"></a>m_byhand &lt;-<span class="st"> </span><span class="kw">lm</span>(rdg_spr <span class="op">~</span><span class="st"> </span>rdg_fall <span class="op">+</span><span class="st"> </span>ell_monitor <span class="op">+</span><span class="st"> </span>ell_non <span class="op">+</span><span class="st"> </span></span>
<span id="cb146-2"><a href="interactions.html#cb146-2"></a><span class="st">                         </span>fall_monitor <span class="op">+</span><span class="st"> </span>fall_non,</span>
<span id="cb146-3"><a href="interactions.html#cb146-3"></a>               <span class="dt">data =</span> interactions)</span>
<span id="cb146-4"><a href="interactions.html#cb146-4"></a><span class="kw">summary</span>(m_byhand)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rdg_spr ~ rdg_fall + ell_monitor + ell_non + fall_monitor + 
##     fall_non, data = interactions)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -36.812  -7.307  -0.100   8.616  26.693 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  180.29666   32.95228   5.471  1.6e-07 ***
## rdg_fall       0.03939    0.18459   0.213   0.8313    
## ell_monitor   -0.47286   53.18886  -0.009   0.9929    
## ell_non      -64.12123   36.80395  -1.742   0.0833 .  
## fall_monitor   0.06262    0.28669   0.218   0.8274    
## fall_non       0.40801    0.20346   2.005   0.0465 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 12.37 on 168 degrees of freedom
## Multiple R-squared:  0.2652, Adjusted R-squared:  0.2433 
## F-statistic: 12.13 on 5 and 168 DF,  p-value: 4.874e-10</code></pre>
<p>And we can verify that this does, indeed, get us the same results that we would have obtained with the shortcut syntax with base R.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="interactions.html#cb148-1"></a><span class="kw">summary</span>(</span>
<span id="cb148-2"><a href="interactions.html#cb148-2"></a>  <span class="kw">lm</span>(rdg_spr <span class="op">~</span><span class="st"> </span>rdg_fall<span class="op">*</span>ell, <span class="dt">data =</span> benchmarks)</span>
<span id="cb148-3"><a href="interactions.html#cb148-3"></a>)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rdg_spr ~ rdg_fall * ell, data = benchmarks)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -36.812  -7.307  -0.100   8.616  26.693 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         180.29666   32.95228   5.471  1.6e-07 ***
## rdg_fall              0.03939    0.18459   0.213   0.8313    
## ellMonitor           -0.47286   53.18886  -0.009   0.9929    
## ellNon-ELL          -64.12123   36.80395  -1.742   0.0833 .  
## rdg_fall:ellMonitor   0.06262    0.28669   0.218   0.8274    
## rdg_fall:ellNon-ELL   0.40801    0.20346   2.005   0.0465 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 12.37 on 168 degrees of freedom
## Multiple R-squared:  0.2652, Adjusted R-squared:  0.2433 
## F-statistic: 12.13 on 5 and 168 DF,  p-value: 4.874e-10</code></pre>
</div>
<div id="creating-interactions-with-recipes" class="section level3" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> Creating interactions with {recipes}</h3>
<p>Specifying interactions in a recipe is similar to other steps, with one small exception, which is that the use of the tilde, <code>~</code>, is required. Note that, once again, order does matter, and you should always do your dummy coding <em>before</em> specifying interactions with categorical variables. In the example before, this would correspond to</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="interactions.html#cb150-1"></a><span class="kw">recipe</span>(rdg_spr <span class="op">~</span><span class="st"> </span>rdg_fall <span class="op">+</span><span class="st"> </span>ell, benchmarks) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb150-2"><a href="interactions.html#cb150-2"></a><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb150-3"><a href="interactions.html#cb150-3"></a><span class="st">  </span><span class="kw">step_interact</span>(<span class="op">~</span>rdg_fall<span class="op">:</span><span class="kw">starts_with</span>(<span class="st">&quot;ell&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb150-4"><a href="interactions.html#cb150-4"></a><span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb150-5"><a href="interactions.html#cb150-5"></a><span class="st">  </span><span class="kw">bake</span>(<span class="dt">new_data =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## # A tibble: 174 x 6
##    rdg_fall rdg_spr ell_Monitor ell_Non.ELL rdg_fall_x_ell_Monitor rdg_fall_x_ell_Non.ELL
##       &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;
##  1      181     194           0           0                      0                      0
##  2      166     159           0           1                      0                    166
##  3      216     198           0           1                      0                    216
##  4      203     204           0           1                      0                    203
##  5      198     173           0           0                      0                      0
##  6      188     173           0           0                      0                      0
##  7      202     200           1           0                    202                      0
##  8      182     206           0           0                      0                      0
##  9      194     191           0           1                      0                    194
## 10      170     185           0           0                      0                      0
## # … with 164 more rows</code></pre>
<p>There are a few things to mention here. First, the data do look identical (minus the column names) to what we created by hand, so that’s good news. However, we also used <code>starts_with</code> here, rather than just specifying something like <code>step_interact(~rdg_fall:ell)</code>. This is because after dummy coding, the column names change (as you can see in the above). By specifying <code>starts_with</code>, we are ensuring that we get all the interactions we need. If we forget this step, we end up with the wrong output, along with a warning.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="interactions.html#cb152-1"></a><span class="kw">recipe</span>(rdg_spr <span class="op">~</span><span class="st"> </span>rdg_fall <span class="op">+</span><span class="st"> </span>ell, benchmarks) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb152-2"><a href="interactions.html#cb152-2"></a><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb152-3"><a href="interactions.html#cb152-3"></a><span class="st">  </span><span class="kw">step_interact</span>(<span class="op">~</span>rdg_fall<span class="op">:</span>ell) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb152-4"><a href="interactions.html#cb152-4"></a><span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb152-5"><a href="interactions.html#cb152-5"></a><span class="st">  </span><span class="kw">bake</span>(<span class="dt">new_data =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## # A tibble: 174 x 4
##    rdg_fall rdg_spr ell_Monitor ell_Non.ELL
##       &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1      181     194           0           0
##  2      166     159           0           1
##  3      216     198           0           1
##  4      203     204           0           1
##  5      198     173           0           0
##  6      188     173           0           0
##  7      202     200           1           0
##  8      182     206           0           0
##  9      194     191           0           1
## 10      170     185           0           0
## # … with 164 more rows</code></pre>
<p>This is because its trying to find a column called <code>ell</code> to multiply with <code>rdg_fall</code>, but no such variable exists after dummy coding.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="nonlinearity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="pca.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
